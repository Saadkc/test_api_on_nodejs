{"version":3,"file":"request-sender.js","names":["_deepAssign","_interopRequireDefault","require","_objectAssign","_methodTypes","_defaultOptions","_payloadTransformer","_requestFactory","obj","__esModule","default","_typeof","Symbol","iterator","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","_toPropertyKey","key","_createClass","protoProps","staticProps","arg","_toPrimitive","String","input","hint","prim","toPrimitive","undefined","res","call","Number","RequestSender","requestFactory","payloadTransformer","value","sendRequest","url","data","options","callback","_this","mergedOptions","deepAssign","DEFAULT_OPTIONS","xhr","createRequest","error","response","fromResponse","isSuccessfulRequest","payload","toRequest","headers","send","postRequest","objectAssign","method","POST","status","create","RequestFactory","PayloadTransformer","exports"],"sources":["../../../src/common/http-request/request-sender.js"],"sourcesContent":["import deepAssign from 'deep-assign';\nimport objectAssign from 'object-assign';\nimport { POST } from './method-types';\nimport DEFAULT_OPTIONS from './default-options';\nimport PayloadTransformer from './payload-transformer';\nimport RequestFactory from './request-factory';\n\nexport default class RequestSender {\n    /**\n     * @returns {RequestSender}\n     */\n    static create() {\n        const requestFactory = RequestFactory.create();\n        const payloadTransformer = PayloadTransformer.create();\n\n        return new RequestSender(requestFactory, payloadTransformer);\n    }\n\n    /**\n     * @param {RequestFactory} requestFactory\n     * @param {PayloadTransformer} payloadTransformer\n     */\n    constructor(requestFactory, payloadTransformer) {\n        /**\n         * @private\n         * @type {RequestFactory}\n         */\n        this.requestFactory = requestFactory;\n\n        /**\n         * @private\n         * @type {PayloadTransformer}\n         */\n        this.payloadTransformer = payloadTransformer;\n    }\n\n    /**\n     * @param {string} url\n     * @param {Object} data\n     * @param {Object} [options]\n     * @param {Function} [callback]\n     * @returns {void}\n     */\n    sendRequest(url, data, options, callback) {\n        const mergedOptions = deepAssign({}, DEFAULT_OPTIONS, options);\n\n        const xhr = this.requestFactory.createRequest(url, mergedOptions, (error) => {\n            const response = this.payloadTransformer.fromResponse(xhr);\n\n            if (!callback) {\n                return;\n            }\n\n            if (error || !this.isSuccessfulRequest(xhr)) {\n                callback(response);\n                return;\n            }\n\n            callback(null, response);\n        });\n\n        const payload = this.payloadTransformer.toRequest(data, mergedOptions.headers['Content-Type']);\n\n        xhr.send(payload);\n    }\n\n    /**\n     * @param {string} url\n     * @param {Object} data\n     * @param {Object} [options]\n     * @param {Function} [callback]\n     * @returns {void}\n     */\n    postRequest(url, data, options, callback) {\n        const mergedOptions = objectAssign({}, options, {\n            method: POST,\n        });\n\n        this.sendRequest(url, data, mergedOptions, callback);\n    }\n\n    /**\n     * @private\n     * @param {XMLHttpRequest} xhr\n     * @returns {boolean}\n     */\n    isSuccessfulRequest(xhr) {\n        return xhr.status >= 200 && xhr.status < 300;\n    }\n}\n"],"mappings":"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"}